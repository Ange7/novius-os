/*
 *
 * Wijmo Library 2.0.0b2
 * http://wijmo.com/
 *
 * Copyright(c) ComponentOne, LLC.  All rights reserved.
 * 
 * Dual licensed under the Wijmo Commercial or GNU GPL Version 3 licenses.
 * licensing@wijmo.com
 * http://wijmo.com/license
 *
 *
 **/
(function(a){"use strict";var b="wijmo-wijribbon",w=b+"-disabled",n=b+"-bigbutton",A=b+"-panel",q=b+"-groups",i=b+"-group",t=i+"-content",v=i+"-label",o=b+"-dropdown",k=b+"-dropdowngroup",p=b+"-abbrev",m=p+"group",B=b+"-text",r=b+"-icon",u=b+"-abbrevicon",y="ui-widget-content",h="ui-helper-reset",C="ui-tabs-nav",g="ui-helper-clearfix",f="ui-corner-all",c="ui-button-text",z="ui-state-default",e="ui-state-hover",d="ui-state-active",x="ui-state-disabled",s="ui-icon",l=s+"-triangle-1-s",j="ui-tabs-hide";a.widget("wijmo.wijribbon",{options:{click:null},_create:function(){var a=this;a._ribbonify();a.options.disabled&&a._setDisabled(true)},_setOption:function(c,b){a.Widget.prototype._setOption.apply(this,arguments);c==="disabled"&&this._setDisabled(b)},_setDisabled:function(e){var d=this,c=d.element,b=d.disabledModal;c.wijtabs("option","disabled",e);if(e){if(!b){b=a("<div></div>").addClass(x+" "+w).css({top:0,left:0,"z-index":"10000","background-color":"lightgray",position:"absolute"}).appendTo(c.parent()).bind("click mousedown mouseup mouseover mouseout focus keydown keypress",function(a){a.stopPropagation();a.preventDefault();return false});d.disabledModal=b}b.width(c.width()).height(c.height()).show()}else b&&b.hide()},_ribbonify:function(){var b=this;b.buttons={};b.listUis={};b._getButtonSets();b._createButtons();b._createGroup();b._createSplit();b._createDropdwon();b._hideShowedList();b._createTab();a("."+h+":not(."+q+", ."+C+")",b.element).hover(function(){a(this).addClass(e)},function(){a(this).removeClass(e)});a(".ui-button",b.element).bind("mouseenter",function(){a("."+c,this).addClass(e)}).bind("mouseleave",function(){a("."+c,this).removeClass(e)});a("button.ui-button").bind("mousedown",function(){b._addActiveClassToButtonText(this)}).bind("mouseup",function(){b._addActiveClassToButtonText(this)});a("label.ui-button").bind("click",function(){b._addActiveClassToLabelButtonText(this)})},_addActiveClassToButtonText:function(b){if(b)if(a(b).hasClass(d))a("."+c,b).addClass(d);else a("."+c,b).removeClass(d)},_addActiveClassToLabelButtonText:function(d){var c=this,b,f,e;if(d){f=a(d).attr("for");b=a("#"+f,c.element);if(b.is(":checkbox"))c._addActiveClassToButtonText(d);else if(b.is(":radio")){e=c.element.find("[name='"+b.attr("name")+"']");a.each(e,function(){c._updateGroupElementTextState(this)})}}},_updateGroupElementTextState:function(e){var f=this,b;if(!e)return;b=a("[for='"+a(e).attr("id")+"']",a(e).parent());if(b)if(b.hasClass(d))b.children("."+c).addClass(d);else b.children("."+c).removeClass(d)},_getButtonSets:function(){var b=this,c;b.groups=[];b.splits=[];b.dropdowns=[];a("span>button, span>:checkbox, span>:radio, div>button, div>:checkbox, div>:radio",b.element).each(function(e,d){c=a(d).parent();if(a(">ul",c).length===0)b.groups.push(c);else if(a(">button",c).length===2)b.splits.push(c);else a(">button",c).length===1&&b.dropdowns.push(c)});b.groups=b._unique(b.groups);b.splits=b._unique(b.splits)},_unique:function(c){var b=a.map(c,function(a){return a.get(0)});return a.map(a.unique(b),function(b){return a(b)})},_createButtons:function(){var b=this,c=b.element;a(":checkbox",c).each(function(){b._createButton(a(this),"checkbox")});a(":radio",c).each(function(){b._createButton(a(this),"radio")});a("button",c).each(function(){b._createButton(a(this),"button")})},_createButton:function(b,h){var g=this,e=g._buildButtonOption(b,h),f=b.data("commandName"),d;b.button(e);if(!e.text)if(h==="button")b.children("."+c).text(f);else{d=a("[for='"+b.attr("id")+"']",b.parent());d&&d.children("."+c).text(f)}g._triggerEvent(b)},_createGroup:function(){a.each(this.groups,function(b,a){a.buttonset()})},_createSplit:function(){var d=this;a.each(d.splits,function(p,i){var e=i.children("ul"),j=i.children("button:eq(0)"),m=j.data("commandName"),k=i.children("button:eq(1)"),n;e.children("li").addClass(f);i.addClass(b+"-"+m);k.button({icons:{primary:l},text:false}).data("list",e).unbind("click").bind("click",function(a){a.stopPropagation();a.preventDefault()}).bind("mouseup",function(b){e=a(this).data("list");if(e.is(":visible")){d.showList.hide().css("z-index","");d.showList=null}else{e.show().position({my:"left top",at:"left bottom",of:i}).css("z-index",9999);d.showList=e}b.stopPropagation();b.preventDefault()});k.children("."+c).text("foo");i.after(e);e.css("position","absolute").addClass(h+" "+g+" "+f+" "+o).hide();i.buttonset();n={ui:j,defaultValue:j.button("option","label"),buttons:[],type:"split",trigger:k,list:e};a("button, :checkbox, :radio",e).bind("click",function(a){e.hide().css("z-index","");d.showList=null;a.preventDefault()});e.find(">li>button,>li>:radio,>li>:checkbox").each(function(e,c){var b=a(c).data("commandName");if(b!==""&&d.buttons[b]){d.buttons[b].parent=j;d.buttons[b].type="split"}n.buttons.push(a(c))});if(m!=="")d.listUis[m]=n})},_createDropdwon:function(){var d=this;d.dropdownLabels={};a.each(d.dropdowns,function(n,j){var i=j.children("ul"),e=j.children("button:eq(0)"),k=e.data("commandName"),m;i.children("li").addClass(f);j.addClass(b+"-"+k);e.button({icons:{secondary:l}}).unbind("click").bind("click",function(a){a.stopPropagation();a.preventDefault()}).bind("mouseup",function(a){if(i.is(":visible")){d.showList.hide().css("z-index","");d.showList=null}else{if(d.showList){d.showList.hide();d.showList=null}i.show().position({my:"left top",at:"left bottom",of:e}).css("z-index",9999);d.showList=i;d.isShow=true}a.stopPropagation();a.preventDefault()});m={ui:e,defaultValue:e.button("option","label"),buttons:[],type:"dropdown",list:i};a("button, :checkbox, :radio",i).bind("click",function(h){var b=a(this).data("commandName"),f,g=e.children("."+c).width();if(!d.dropdownLabels[b])d.dropdownLabels[b]=d._getDropdownLabelSubstr(a(this).button("option","label"),e.children("."+c),g);f=d.dropdownLabels[b];e.button("option","label",f);e.attr("title",a(this).button("option","label"));i.hide().css("z-index","");d.showList=null;h.preventDefault()});i.css("position","absolute").addClass(h+" "+g+" "+f+" "+o).hide();j.buttonset();i.find(">li>button,>li>:radio,>li>:checkbox").each(function(f,c){var b=a(c).data("commandName");if(b!==""&&d.buttons[b]){d.buttons[b].parent=e;d.buttons[b].type="dropdown"}m.buttons.push(a(c))});if(k!=="")d.listUis[k]=m})},_createTab:function(){var d=this,c=d.element;c.addClass(b);d.tabEle=c;if(a(">ul",c).length>0){c.wijtabs();d._createRibbonGroups();return true}else c.addClass(b+"-simple").addClass(g);return false},updateRibbonSize:function(){var b=this;b.tabEle.children("div").each(function(i,h){var c=a(h),e=c.is(":visible"),g=c.find(">ul>li"),f=[],d;d=c.width();if(!e){c.removeClass(j);d=c.width()}g.each(function(g,e){var b=a(e),c=b.find(">div:last"),d=a.trim(c.text());f.push({width:b.outerWidth(true),text:d})});b._adjustRibbonGroupIfNeeded(g,f,d);!e&&c.addClass(j)})},_createRibbonGroups:function(){var c=this;c.tabEle.children("div").each(function(p,o){var d=a(o),l=d.is(":visible"),n=d.find(">ul>li"),k=[],m;!l&&d.removeClass(j);m=d.width();d.addClass(A);d.find(">ul").addClass(h+" "+g+" "+y+" "+f+" "+q);n.each(function(j,h){var c=a(h),d=c.find(">div:last"),g=z+" "+i,f=a.trim(d.text());if(d)g+=" "+b+"-"+f.toLowerCase();c.addClass(g);d.addClass(v);c.wrapInner("<div class = '"+t+"'></div>");c.children().bind("mouseover",function(){a(this).addClass(e)}).bind("mouseout",function(){a(this).removeClass(e)});d.appendTo(c);k.push({width:c.outerWidth(true),text:f})});c._originalGroupInfo=k;c._adjustRibbonGroupIfNeeded(n,k,m);!l&&d.addClass(j)})},_adjustRibbonGroupIfNeeded:function(d,f,n){for(var o=this,c=d.length-1,g=0,j=0,i=0,e,h,l;c>=0;c--){i=0;for(g=0;g<c;g++)i+=f[g].width;if(i+j+f[c].width<=n){e=a(d[c]).children("."+k);h=a(d[c]).children("."+m);if(e){a(d[c]).addClass(b+"-"+f[c].text.toLowerCase()).prepend(e.children());e.remove();h&&h.remove()}}else{l=f[c];j+=o._createDropDownRibbonGroup(l.text,d[c])}}},_createDropDownRibbonGroup:function(f,j){var c=this,g=b+"-"+f.toLowerCase(),d=a(j).removeClass(g),h;d.wrapInner("<div class='"+k+" "+i+"'></div>").children().hide().addClass(g).bind("mouseup."+c.widget,function(){if(c.showDrpDwnGroup!==null){c.showDrpDwnGroup.hide().css("z-index","");c.showDrpDwnGroup=null}});h=a("<div class='"+m+"'><span class='"+p+f.toLowerCase()+" "+r+" "+u+"'></span><span class='"+B+"'>"+f+"</span><span class='"+s+" "+l+" "+r+"'></span></div>").appendTo(d).unbind(c.widget).bind("mouseover."+c.widget,function(){a(this).addClass(e)}).bind("mouseout."+c.widget,function(){a(this).removeClass(e)}).bind("click."+c.widget,function(d){var b=a(this).siblings("."+k);if(b.is(":visible")){b.hide().css("z-index","");c.showDrpDwnGroup=null}else{c.showDrpDwnGroup&&c.showDrpDwnGroup.hide().css("z-index","");b.show().position({my:"left top",at:"left bottom",of:this}).css("z-index","10000");c.showDrpDwnGroup=b;d.stopPropagation()}});return d.outerWidth(true)},_hideShowedList:function(){var b=this;a(document).bind("mouseup",function(d){var c=d.target;if(b.showList)if(a(c).is(document)||!a.contains(b.showList.get(0),c)){b.showList.hide().css("z-index","");b.showList=null}if(b.showDrpDwnGroup)if(a(c).is(document)||!a.contains(b.showDrpDwnGroup.get(0),c)){b.showDrpDwnGroup.hide().css("z-index","");b.showDrpDwnGroup=null}})},_buildButtonOption:function(b,j){var k=true,m=this,d=b.attr("class"),c,f,i,l,g,e,h;if(d&&d!==""&&d!==n){f=d.split(" ")[0];b.removeClass(f);g=a.trim(b.text());if(g==="")k=false}else{if(j==="checkbox"||j==="radio"){if(a.trim(b.attr("id"))==="")return;e=a("[for='"+b.attr("id")+"']",b.parent());if(!e.is("label"))return;d=e.attr("class");if(d&&d!==""&&d!==n){f=d.split(" ")[0];e.removeClass(f);g=a.trim(e.text());if(g==="")k=false}else c=e.children("span,div")}else if(j==="button")c=b.children("span,div");if(c)if(c.length===1){if(c.eq(0).attr("class")!==""){i=c.eq(0);f=i.attr("class");k=false}}else if(c.length===2){if(c.eq(0).attr("class")){i=c.eq(0);f=i.attr("class");if(i.is("span"))l="left";else if(i.is("div"))l="top";g=c.eq(1).text()}}else if(j==="button"&&a.trim(b.text())!=="")g=a.trim(b.text())}if(j==="button"){b.empty();h=a.trim(b.attr("name"));h!==""&&b.removeAttr("name")}else{h=a.trim(e.attr("name"));h!==""&&e.removeAttr("name")}if(h!==""){b.data("commandName",h);m.buttons[h]={button:b}}return{label:g,icons:{primary:f},position:l,text:k}},_triggerEvent:function(a){var b=this;a.bind("click",function(e){var f=a.data("commandName"),c=b.buttons[f],d={};if(c&&c.parent)d.name=c.parent.data("commandName");d.commandName=f;b._trigger("click",e,d);if(a.is("button")){e.preventDefault();e.stopPropagation()}})},_getDropdownLabelSubstr:function(i,l,h){var j=this,k=i.length,e=0,f=k,c=Math.floor((e+f)/2),d=a("<span></span>"),g=i.substr(0,c),b;d.appendTo(l.parent());b=j._calculateWidth(g,d);while(b!==h&&f>e){g=i.substr(0,c+1);b=j._calculateWidth(g,d);if(b>h)f=c-1;else if(b<h)e=c+1;c=Math.floor((e+f)/2)}d.remove();return g},_calculateWidth:function(b,a){a.text(b);return a.width()},hideDropdown:function(b){var c=this,a=c.listUis[b];a&&a.list&&a.list.hide()},getDropdownList:function(d){var e=this,c=e.listUis[d],b={};c&&a.each(c.buttons,function(c,a){b[a.data("commandName")]=a.button("option","label")});return b},setButtonDisabled:function(d,h){var f=this.buttons[d],g=false,b,e;if(f&&f.button){b=f.button;g=b.is("button");b.button("option","disabled",h);if(g)b.children("."+c).text(d);else a("[for='"+b.attr("id")+"']",b.parent()).children("."+c).text(d);e=this.listUis[d];if(e&&e.type==="split"){e.trigger.button("option","disabled",h);e.trigger.children("."+c).text(d)}}},setButtonsDisabled:function(b){var c=this;a.each(b,function(b,a){c.setButtonDisabled(b,a)})},setButtonsChecked:function(c){var b=this;a.each(c,function(d,c){if(a.isPlainObject(c))b.setButtonChecked(d,c.checked,c.name);else b.setButtonChecked(d,c)})},setButtonChecked:function(h,i,l){var f=this,j,b=f.buttons[h],e,g,k;if(b&&b.button){e=b.button;if(e.is("button"))if(i)e.addClass(d);else e.removeClass(d);else{e.attr("checked",i);e.button("refresh")}if(b.parent){if(b.type==="dropdown")if(i){if(!f.dropdownLabels[h])f.dropdownLabels[h]=f._getDropdownLabelSubstr(e.button("option","label"),b.parent.children("."+c),b.parent.children("."+c).width());k=f.dropdownLabels[h];b.parent.button("option","label",k);b.parent.attr("title",e.button("option","label"));j=a(":radio",b.parent.closest("ul"));j&&a.each(j,function(){f._updateGroupElementTextState(this)})}}else f._addActiveClassToButtonText(e.button("widget"))}else if(l){g=f.listUis[l];if(g){g.ui.button("option","label",g.defaultValue);g.buttons&&a.each(g.buttons,function(b,a){a.attr("checked",false);a.button("refresh");f._addActiveClassToButtonText(a.button("widget"))})}}}})})(jQuery);