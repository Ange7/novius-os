/*
 * jQuery inputFileThumb Plugin
 *
 * Copyright (c) 2011 Novius Labs (Gilles FELIX & Antoine LEFEUVRE)
 *
 * version: 1.0.1 (30-JUN-2011)
 * @requires jQuery v1.4.4 or later
 * @optional bgiframe plugin to deal with IE z-index issues
 *
 * Examples and documentation at: http://www.novius-labs.com/contributions/jquery-plugin-inputfile/
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 */
(function(b){function a(c,e){if(c.InputFileThumb){c.InputFileThumb.options=b.extend(c.InputFileThumb.options,e||{});c.InputFileThumb.modify(true);return}var d=this;this.openchoose=false;this.input=b(c).change(function(g){d.modify();d.hide()}).click(function(g){if(b.browser.webkit&&!d.openchoose){d.openchoose=setTimeout(function(){b("body").one("mousemove",function(){d.openchoose=false;d.hide()})},500)}});this.options={};b.extend(this.options,this.defaultSettings,e||{});if(!b.isFunction(this.options.cbVisualize)&&this.options.file){this.options.cbVisualize=function(){window.open(d.options.file)}}var f=this.options.title;if(!f){f=b(c).attr("title")}if(!f){f=b(c).attr("name")}this.container=b('<span class="inputFileThumb"></span>').insertAfter(this.input);this.thumb=b('<span class="thumb"><span class="bg"></span></span>').mouseenter(function(){d.show()}).appendTo(this.container);this.hover=b('<div class="hover"></div>').mouseleave(function(){if(!b.browser.webkit||!d.openchoose){d.hide()}}).appendTo(this.container);this.fileThumb=b('<span class="fileThumb"></span>').appendTo(this.hover);this.fileDesc=b('<span class="fileDesc"><span class="fileTitle">'+f+'</span><span class="fileInfo">'+this.options.description+"</span></span>").appendTo(this.hover);this.fileActions=b('<div class="fileActions"></div>').appendTo(this.hover);this.addFile=b('<span class="addFile">'+this.options.addTitle+"</span>").appendTo(this.fileActions);this.editFile=b('<span class="editFile">'+this.options.editTitle+"</span>").appendTo(this.fileActions);if(this.options.deleteInput){this.deleteInput=b('<input type="hidden" class="deleteInput" name="'+this.options.deleteInput+'" value="" />').appendTo(this.fileActions);this.deleteFile=b('<span class="deleteFile">'+this.options.delTitle+"</span>").appendTo(this.fileActions).click(function(g){g.stopImmediatePropagation();d.remove()})}this.modify(true);c.InputFileThumb=this;return}b.extend(a.prototype,{defaultSettings:{file:"",title:"",width:58,height:58,description:"",extensions:[],deleteInput:false,displayExtension:true,orientation:"",classes:"",addTitle:"Add",editTitle:"Edit",delTitle:"Delete",wrongExtensionMessage:"This extension is not allowed",cbCheckExt:false,cbVisualize:false},extensionsType:{image:["gif","jpg","jpeg","png","bmp"]},iconByExtension:function(e){this.thumb.empty().append('<span class="bg"></span>').css({"text-align":"right",cursor:"default"});var c=this;var d=this.options.classes;if(!d){b.each(this.extensionsType,function(i,g){var h=false;if(c.options.extensions.length>0){h=true;b.each(c.options.extensions,function(j,k){if(b.inArray(k,g)==-1){h=false;return true}return false})}if(h){d=i;return true}else{if(b.inArray(e,g)!=-1){d=i;return true}}return false})}if(e){var f=b("span.bg",this.thumb).addClass(d+" on");if(this.options.displayExtension&&e!="-"){f.append('<span class="'+e+'">'+e+"</span>")}}else{var f=b("span.bg",this.thumb).addClass(d);if(this.options.displayExtension&&this.options.extensions.length==1){f.append('<span class="'+this.options.extensions[0]+'">'+this.options.extensions[0]+"</span>")}}},modify:function(h){h=h||false;var f=false;var e=this.input.val();if(h){e=this.options.file}if(e){f="-";var g=e.match(/.+\.(\w{2,4})(\?|$)/gi);if(b.isArray(g)&&g.length){f=RegExp.$1}if(this.options.extensions.length&&b.inArray(f,this.options.extensions)==-1){if(b.isFunction(this.options.cbCheckExt)){this.options.cbCheckExt(f,this.options.extensions)}else{alert(this.options.wrongExtensionMessage)}this.input.val("");this.modify();return}this.hover.css("cursor","default");this.input.appendTo(this.editFile);this.addFile.hide();this.editFile.show();if(this.deleteInput){this.deleteInput.val("");this.deleteFile.show()}}else{this.input.appendTo(this.hover);this.hover.css("cursor","pointer");this.addFile.show();this.editFile.hide();if(this.deleteInput){this.deleteFile.hide()}}this.iconByExtension(f);var d=this;if(h&&e&&b.inArray(f,this.extensionsType.image)!=-1){this.thumb.empty().css({"text-align":"center",cursor:"pointer"}).width(this.options.width).height(this.options.height);var c={width:this.thumb.innerWidth(),height:this.thumb.innerHeight()};b('<img src="'+e+'" />').load(function(){var j=b(this).width();var i=b(this).height();if(i>j){if(j>c.width){b(this).width(c.width+"px")}}else{if(i>c.height){b(this).height(c.height+"px")}else{b(this).css("margin-top",(c.height-i)/2+"px")}}b(this).css({display:""}).appendTo(d.thumb)}).css({display:"none"}).appendTo(b("body"))}else{this.options.cbVisualize=false;b("span.bg",this.thumb).css("line-height",this.options.height+"px").add(this.thumb).width(this.options.width).height(this.options.height)}},remove:function(){this.deleteInput.val("1");this.options.file="";this.input.val("");this.modify();this.hide()},show:function(){this.hover.css({top:0,left:0,opacity:0}).show();this.fileThumb.css("float","left");this.fileDesc.css("margin-left","10px");this.fileActions.css("margin-left",(this.options.width+10)+"px");var h=this.thumb.clone(false).appendTo(this.fileThumb);if(b.isFunction(this.options.cbVisualize)){h.bind("click",this.options.cbVisualize)}var g=this.thumb.offset();var f=g.left;var e=g.top;var c=this.thumb.offsetParent().not("body");if(c.size()){g=c.offset();f-=g.left;e-=g.top}var d={left:this.hover.css("padding-left").replace("px",""),top:this.hover.css("padding-top").replace("px",""),right:this.hover.css("padding-right").replace("px","")};if(this.options.orientation=="rtl"||(f-d.left+this.hover.outerWidth())>b(window).width()){this.fileThumb.css("float","right");this.fileDesc.css({"margin-right":"10px","margin-left":"0px"});this.fileActions.css({"margin-right":(this.options.width+10)+"px","margin-left":"0px"});this.hover.css({top:e-d.top,left:f+d.right+this.thumb.outerWidth()-this.hover.outerWidth()})}else{this.hover.css({top:e-d.top,left:f-d.left})}if(b.fn.bgiframe){this.hover.bgiframe()}this.hover.css("opacity",1)},hide:function(){b(".thumb",this.hover).remove();this.hover.hide()}});b.fn.inputFileThumb=function(c){return this.each(function(){new a(this,c)})}})(jQuery);
